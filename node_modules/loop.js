var google = require('./google');
var slack = require('./slack');

var loop = function() {
    google.reAuthorize(makeMessage);
};


var makeMessage = function(events) {
    for (var i = 0; i < events.length; i++) {
        var event = events[i];
        var start = event.start.dateTime || event.start.date;
        var date = new Date(start);
        var today = new Date();

        if ( today.getMonth() == date.getMonth()) {
            if (today.getDate() == date.getDate()) {
                if (today.getHours() == date.getHours()) {
                    if (checkTenMinutesBefore(today.getMinutes(), date.getMinutes())) {
                        var message = event.summary + "まで10分前です。";
                        slack.sayBot(message);
                    } else {
                        console.log("10分前ではない");
                    }
                    if (checkOneMinutesBefore(today.getMinutes(), today.getMinutes() + 1)) {
                        var message = event.summary + "まで1分前です。";
                        slack.sayBot(message);
                    } else {
                        console.log("1分前ではない");
                    }
                } else {
                    console.log("違う時間です。");
                }
            } else {
                console.log("違う日");
            }
        } else {
            console.log("違う月");
        }
    }
};

var checkTenMinutesBefore = function(m1, m2) {
    if (m1 < m2) {
        if (m2 - m1 == 10) {
            return true;
        } else {
            return false;
        }
    } else {
        return false;
    }
};

var checkOneMinutesBefore = function(m1, m2) {
    if (m1 < m2) {
        if (m2 - m1 == 1) {
            return true;
        } else {
            return false;
        }
    } else {
        return false;
    }
};


module.exports = loop;